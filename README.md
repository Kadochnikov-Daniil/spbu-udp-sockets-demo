# UDP Process Synchronization (Ping-Pong / Multivibrator)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–≤—É—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ "–ü–∏–Ω–≥-–ü–æ–Ω–≥" –∏–ª–∏ "–ú—É–ª—å—Ç–∏–≤–∏–±—Ä–∞—Ç–æ—Ä", –∏—Å–ø–æ–ª—å–∑—É—è **UDP —Å–æ–∫–µ—Ç—ã** –≤ —Å—Ä–µ–¥–µ Linux.

–í–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–º—å—é—Ç–µ–∫—Å—ã, —Å–µ–º–∞—Ñ–æ—Ä—ã, —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫), –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ `localhost`.

## üìù –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (**Process A** –∏ **Process B**), –∫–æ—Ç–æ—Ä—ã–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—é—Ç —Å–≤–æ–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

1.  **–°–æ—Å—Ç–æ—è–Ω–∏–µ READY (–ê–∫—Ç–∏–≤–Ω–æ–µ)**: –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–µ–∑–Ω—É—é —Ä–∞–±–æ—Ç—É (–∏–º–∏—Ç–∏—Ä—É–µ—Ç—Å—è `sleep(1)`).
2.  **–°–æ—Å—Ç–æ—è–Ω–∏–µ SLEEP (–û–∂–∏–¥–∞–Ω–∏–µ)**: –ü—Ä–æ—Ü–µ—Å—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –∂–¥–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–∞.

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
–ü—Ä–æ—Ü–µ—Å—Å—ã –ø–µ—Ä–µ–¥–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É —É—Å–ª–æ–≤–Ω—ã–π "—Ç–æ–∫–µ–Ω" (UDP-–¥–∞—Ç–∞–≥—Ä–∞–º–º—É).
*   –ö–æ–≥–¥–∞ **–ü—Ä–æ—Ü–µ—Å—Å –ê** –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É (READY), –æ–Ω –ø–æ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –ü—Ä–æ—Ü–µ—Å—Å—É B –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è (SLEEP).
*   **–ü—Ä–æ—Ü–µ—Å—Å B**, –ø–æ–ª—É—á–∏–≤ —Å–∏–≥–Ω–∞–ª, –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è (–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ READY), –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É, –ø–æ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –æ–±—Ä–∞—Ç–Ω–æ –ü—Ä–æ—Ü–µ—Å—Å—É –ê –∏ —Å–Ω–æ–≤–∞ –∑–∞—Å—ã–ø–∞–µ—Ç.

–≠—Ç–æ—Ç —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –∏—Ç–µ—Ä–∞—Ü–∏–π).

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ —è–∑—ã–∫–µ C –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã POSIX:

*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏**: `fork()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, `wait()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
*   **–°–µ—Ç—å**:
    *   `socket(AF_INET, SOCK_DGRAM, ...)` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ UDP —Å–æ–∫–µ—Ç–æ–≤.
    *   `bind()` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ—Ä—Ç–∞–º (A: 9001, B: 9002).
    *   `sendto()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ø–µ—Ä–µ—Ö–æ–¥ –≤ SLEEP).
    *   `recvfrom()` ‚Äî –±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è SLEEP).

**–í–∞–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å UDP**:
–¢–∞–∫ –∫–∞–∫ UDP –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É –∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –ü—Ä–æ—Ü–µ—Å—Å –ê (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä) –¥–µ–ª–∞–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É –Ω–∞ —Å—Ç–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –¥–∞—Ç—å –ü—Ä–æ—Ü–µ—Å—Å—É B –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∫–µ—Ç –∏ –≤—Å—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è (`recvfrom`).

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   GCC (GNU Compiler Collection)
*   Make
*   Linux (Ubuntu/Debian –∏ –¥—Ä.)

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

1.  **–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
    –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `make` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. –≠—Ç–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª `pingpong`.
    ```bash
    make
    ```

2.  **–ó–∞–ø—É—Å–∫**:
    –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
    ```bash
    make run
    # –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:
    ./pingpong
    ```

3.  **–û—á–∏—Å—Ç–∫–∞**:
    –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
    ```bash
    make clean
    ```

## üìã –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```text
=== –ó–∞–ø—É—Å–∫ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–∏–Ω–≥-–ø–æ–Ω–≥ —á–µ—Ä–µ–∑ UDP ===
Host: 127.0.0.1, Port A: 9001, Port B: 9002

[Process B] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ü–æ—Ä—Ç: 9002
[Process B] –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: SLEEP (–∂–¥—É –ø–∞–∫–µ—Ç–∞ –æ—Ç A)
[Process A] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ü–æ—Ä—Ç: 9001
[Process A] –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: READY

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 (Process A) ---
[Process A] –†–∞–±–æ—Ç–∞—é (READY)...
[Process A] –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å—É B...
[Process A] –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ SLEEP (–∂–¥—É –ø–∞–∫–µ—Ç–∞ –æ—Ç B)...

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 (Process B) ---
[Process B] –ê–≥–µ–Ω—Ç –ø–æ–ª—É—á–µ–Ω! –ü—Ä–∏–Ω—è—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ 'TOKEN_FROM_A'.
–ü–µ—Ä–µ—Ö–æ–¥ –≤ READY.
[Process B] –†–∞–±–æ—Ç–∞—é (READY)...
[Process B] –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å—É A...
[Process B] –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ SLEEP (–∂–¥—É –ø–∞–∫–µ—Ç–∞ –æ—Ç A)...

[Process A] –ê–≥–µ–Ω—Ç –ø–æ–ª—É—á–µ–Ω! –ü—Ä–∏–Ω—è—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ 'TOKEN_FROM_B'.
–ü–µ—Ä–µ—Ö–æ–¥ –≤ READY.
...
